\documentclass[]{article}



\usepackage{graphicx,forloop,caption,subcaption,float,hyperref,arrayjob,listings,color,booktabs,mathtools}
\usepackage{pdfpages}
\usepackage[margin=1.2in]{geometry}
\usepackage{amsmath}
\usepackage{multirow}
%vhdl code
\definecolor{dkgreen}{rgb}{0,0.6,0}
\definecolor{gray}{rgb}{0.5,0.5,0.5}
\definecolor{mauve}{rgb}{0.58,0,0.82}

\DeclareMathOperator*{\argmin}{\arg\!\min}


\lstset{frame=tb,
  language=VHDL,
  aboveskip=3mm,
  belowskip=3mm,
  showstringspaces=false,
  columns=flexible,
  basicstyle={\small\ttfamily},
  numbers=none,
  numberstyle=\tiny\color{gray},
  keywordstyle=\color{blue},
  commentstyle=\color{dkgreen},
  stringstyle=\color{mauve},
  breaklines=true,
  breakatwhitespace=true
  tabsize=3
}

%matlab code
\lstset{frame=tb,
  language=Matlab,
  aboveskip=3mm,
  belowskip=3mm,
  showstringspaces=false,
  columns=flexible,
  basicstyle={\small\ttfamily},
  numbers=none,
  numberstyle=\tiny\color{gray},
  keywordstyle=\color{blue},
  commentstyle=\color{dkgreen},
  stringstyle=\color{mauve},
  breaklines=true,
  breakatwhitespace=true
  tabsize=3
}


% Title Page
\title{UCLA\\EE230B\\Digital Communication Design Project\\Step 2 Report}
\author{Alican Salor 404271991 \\  \href{mailto:alicansalor@ucla.edu}{alicansalor@ucla.edu} \\ \\
Darren Reis 804359840 \\
\href{mailto:darrer.r.reis@gmail.com}{darren.r.reis@gmail.com} }


\begin{document}
\maketitle

\newpage
\tableofcontents

\newpage


\section{System Setup}
\label{sec:setup}
The system is as shown in Figure below:


\begin{figure}[H]
\centering
\includegraphics[width=\textwidth]{step1diagram.jpg}
\caption{Diagram of the setup used in step 1 of the project}
\end{figure}

To simulate the system, code was written for each block in the diagram.  A random bit generator was used to output a stream of data (Appendix~\ref{app:random_bit_generator}). In order to make sure enough trials are made for the simulation, the number of the bits generated is set to 48000. The data stream was then passed into a bit-to-symbol mapper, transformed differently based on the modulation scheme (Appendix~\ref{app:bittosym}).  Various schemes were used, including Binary Phase Shift Keying [BPSK], Quadrature Phase Shift Keying [QPSK], and Quadrature Amplitude Modulation [QAM], as shown in Appendices~\ref{app:bpsk_mod}~$-$~\ref{app:qam_64_mod}. To approximate a real system:

\begin{itemize}
\item The system got passed through a square root raised cosine pulse (Appendix~\ref{app:sqrt_raised_cosine}) which has the following impulse response:

 \[
 h(t) = \begin{dcases*}
        1-\beta+4\frac{\beta}{\pi} &  $t = 0$\\ \\        
        \frac{\beta}{\sqrt{2}}\left[\left(1+\frac{2}{\pi}\right)\sin\left(\frac{\pi}{4\beta}\right)+\left(1-\frac{2}{\pi}\right)\cos\left(\frac{\pi}{4\beta}\right)\right] & $t=\pm \frac{T_s}{4\beta}$ \\ \\
        \frac{\sin\left[\pi\frac{t}{Ts}\left(1-\beta\right)\right]+4\beta\frac{t}{Ts}\cos\left[\pi\frac{t}{Ts}\left(1+\beta\right)\right]}{\pi\frac{t}{Ts}\left[1-\left(4\beta\frac{t}{Ts}\right)^2\right]} & $otherwise$ \\
        \end{dcases*}
\]

\item This filter was then oversampled by four (Appendix~\ref{app:impulse_train}).
\item Furthermore, it was broadcast over an Additive White Gaussian Noise (AWGN) channel. (Appendix~\ref{app:awgn_channel}). This channel modeled the transmission of the signal from transmitter to receiver. The variance of this channel is determined by the SNR values picked at the beginning of each simulation. In order to achieve this the following equation is used:

$\sigma^2 = S/(10^{SNR/10})$

where S is the average signal power of the chosen modulation scheme.

\item At the receiver, a matched filter is used for optimal detection of the transmitted signal. As square root raised cosine pulse is used at the transmission side (which a real symmetric pulse), the same square root raised cosine pulse shape is used as the matched filter.  

\item After sampling the symbol stream back at the original symbol rate, the message is ready for recovery (Appendix~\ref{app:sampler}).

\item Finally, the data waveform is sent through a decision block, demodulating according to the appropriate scheme (Appendices~\ref{app:bpsk_demod}~$-$~\ref{app:qam_64_demod}).

\end{itemize}

An analysis of performance of the system was determined by comparing a theoretical error rate to experimental bit error rate for various schemes.  The theoretical derivation is shown in Section~\ref{sec:deriv}. On the other hand, the experimental error rate was found by counting the instances of wrongly decoded symbols (or bits as in BPSK case) and dividing this number by the number of total symbols sent through the channel.  

\section{Mathematical Derivations of Probability of Error}
\label{sec:deriv}
As equiprobable bits are generated and passed through an AWGN channel in this project, the ML decision rule was used.  It states: \\

$\hat{m} = \argmin_{1\leq m \leq M}{||\underline{r} - \underline{s}_m||}$ 
\\

Thus, in the following subsections, the probability of error for each constellation used in the project is derived using the minimum distance rule.

Furthermore the formulas are used to convert the minimum distance to the average bit energy and the average symbol energy to average bit energy in the M-QAM constellations:\\

$d_{min} = \sqrt{\frac{6log_2M}{M-1}E_{bavg}} $\\ \\

$E_{bavg} = \frac{E_{savg}}{log_2M}$



\subsection{BPSK}
\label{sec:bpsk}
The exact probability of bit error is as follows (no interesting decision regions):\\

$ P_{be} = Q\left(\frac{d_{min}/2}{\sqrt{N_o/2}}\right) $ \\ \\

$ P_{be} = Q\left(\sqrt{2\frac{E_b}{N_o}}\right) $ \\

\subsection{QPSK}
\label{sec:qpsk}

The exact probability of symbol error is as follows (found by subtracting the interesting decision regions from the nearest neighbor approx.):\\

$ P_{se} = 2Q\left(\frac{d_{min}/2}{\sqrt{N_o/2}}\right)-Q\left(\frac{d_{min}/2}{\sqrt{N_o/2}}\right)^2$ \\ \\

$ P_{se} = 2Q\left(\sqrt{2\frac{E_{bavg}}{N_o}}\right)-Q\left(\sqrt{2\frac{E_{bavg}}{N_o}}\right)^2$ \\

A good approximation of the theoretical bit error can be by dividing the symbol error rate by the number of bits used for each symbol. Then:\\

 $ P_{be} = \frac{1}{2}\left[2Q\left(\sqrt{2\frac{E_{bavg}}{N_o}}\right)-Q\left(\sqrt{2\frac{E_{bavg}}{N_o}}\right)^2\right]$ \\


\subsection{16-QAM}
\label{sec:qam16}

The exact probability of symbol error is as follows (found by subtracting the interesting decision regions from the nearest neighbor approx.):\\

$ P_{se} = 3Q\left(\frac{d_{min}/2}{\sqrt{N_o/2}}\right)-(9/4)Q\left(\frac{d_{min}/2}{\sqrt{N_o/2}}\right)^2$ \\ \\

$ P_{se} = 3Q\left(\sqrt{\frac{4}{5}\frac{E_b}{N_o}}\right)-(9/4)Q\left(\sqrt{\frac{4}{5}\frac{E_{b}}{N_o}}\right)^2$  \\

A good approximation of the theoretical bit error can be by dividing the symbol error rate by the number of bits used for each symbol. Then:\\

$ P_{be} = \frac{1}{4}\left[3Q\left(\sqrt{\frac{4}{5}\frac{E_b}{N_o}}\right)-(9/4)Q\left(\sqrt{\frac{4}{5}\frac{E_{b}}{N_o}}\right)^2\right]$  \\


\subsection{64-QAM}
\label{sec:qam64}
The exact probability of symbol error is as follows (found by subtracting the interesting decision regions from the nearest neighbor approx.):\\

$P_{se} = (7/2)Q\left(\frac{d_{min}/2}{\sqrt{N_o/2}}\right) -(49/16)Q\left(\sqrt{\frac{d_{min}/2}{\sqrt{N_o/2}}}\right)^2$ \\ \\

$P_{se} = (7/2)Q\left(\sqrt{\frac{18}{63}\frac{E_b}{N_o}}\right)-(49/16)Q\left(\sqrt{\frac{18}{63}\frac{E_b}{N_o}}\right)^2$ \\

A good approximation of the theoretical bit error can be by dividing the symbol error rate by the number of bits used for each symbol. Then:\\

$P_{be} = \frac{1}{6}\left[(7/2)Q\left(\sqrt{\frac{18}{63}\frac{E_b}{N_o}}\right)-(49/16)Q\left(\sqrt{\frac{18}{63}\frac{E_b}{N_o}}\right)^2\right]$ \\

\section{Step 1 Results}
In the following sections, the probability of bit error versus the signal to noise ratio is shown on scatter plots for BPSK, QPSK, 16-QAM and 64-QAM constellations .

\subsection{Probability of Error vs SNR plots}
In the sections given below considering BPSK, QPSK, 16-QAM and 64-QAM constellations the following  are plotted using the MATLAB functions given in the appendix:
\begin{itemize}
\item Theoretical Bit Error Rate/Symbol Error Rate curve as a function of the symbol SNR
\item The theoretical Bit Error Rate/Symbol Error Rate curve as a function of $E_b/N_o$
\item The Bit Error Rate/Symbol Error Rate curve from the simulation as a function of the received signal's SNR
\end{itemize}

\subsubsection{BPSK}
\begin{figure}[H]
\centering
\hspace*{-2cm}\includegraphics[width=1.3\textwidth]{bpSNR.jpg}
\caption{Theoretical and Experimental error rates versus different SNR levels at which the BPSK modulation is run }
\end{figure}
\subsubsection{QPSK}
\begin{figure}[H]
\centering
\hspace*{-2cm}\includegraphics[width=1.3\textwidth]{qpSNR.jpg}
\caption{Theoretical and Experimental error rates versus different SNR levels at which the QPSK modulation is run }
\end{figure}
\subsubsection{16-QAM}
\begin{figure}[H]
\centering
\hspace*{-2cm}\includegraphics[width=1.3\textwidth]{qam16SNR.jpg}
\caption{Theoretical and Experimental error rates versus different SNR levels at which the 16-QAM modulation is run }
\end{figure}
\subsubsection{64-QAM}
\begin{figure}[H]
\centering
\hspace*{-2cm}\includegraphics[width=1.3\textwidth]{qam64SNR.jpg}
\caption{Theoretical and Experimental error rates versus different SNR levels at which the 64-QAM modulation is run }
\end{figure}
\subsection{Constellation Plots}
In the following sections scatter plots of BPSK, QPSK, 16-QAM and 64-QAM constellations are plotted at symbol/input SNRs of 3 dB, 6dB, 10dB and 20dB.

\subsubsection{BPSK}
\begin{figure}[H]
\centering
\hspace*{-2cm}\includegraphics[width=1.3\textwidth]{bpConst.jpg}
\caption{The constellation plots for different levels of SNR at which the BPSK modulation is run }
\end{figure}
\subsubsection{QPSK}
\begin{figure}[H]
\centering
\hspace*{-2cm}\includegraphics[width=1.3\textwidth]{qpConst.jpg}
\caption{The constellation plots for different levels of SNR at which the QPSK modulation is run}
\end{figure}
\subsubsection{16-QAM}
\begin{figure}[H]
\centering
\hspace*{-2cm}\includegraphics[width=1.3\textwidth]{qam16Const.jpg}
\caption{The constellation plots for different levels of SNR at which the 16-QAM modulation is run}
\end{figure}
\subsubsection{64-QAM}
\begin{figure}[H]
\centering
\hspace*{-2cm}\includegraphics[width=1.3\textwidth]{qam64Const.jpg}
\caption{The constellation plots for different levels of SNR at which the 64-QAM modulation is run}
\end{figure}

\newpage

\section{Conclusion}
\label{sec:conc}
This project was a demonstration of a digital communication with various modulation schemes which are:
\begin{itemize}
\item BPSK
\item QPSK
\item 16-QAM
\item 64-QAM
\end{itemize}

Randomly generated and equally probable bits are modulated using the given schemes above.  They are filtered with a square-root raised cosine pulse and passed through an AWGN channel whose noise is varied from tolerable to overpowering.  This can be seen in the both sets of plots.  These plots were made by sending 48,000 bits through the system and measuring the error rate, as explained through the report.

The following are deduced from this step of the project:
\begin{itemize}
\item For each modulation scheme, \emph{increasing} the input SNR \emph{decreases} the probability of symbol error
\item \emph{Increasing} the constellation size \emph{increases} the bit rate.  That being said, the plots show the probability of symbol error \emph{increases} as well.
\item With sufficient simulation test bits, experimental error rates match up with  the theoretical probability of symbol error. 
\item As the constellation size \emph{increases}, the difference between experimental and theoretical bit error rates at low SNR values \emph{amplifies}. However, at high SNR levels, theoretical and experimental bit error rates are almost identical. This is due to the theoretical bit error rates being crudely approximated (dividing the theoretical symbol error rates by the number of bits used per symbol). By doing so, we assume that bit errors are only caused by a one-bit difference.  This underestimates the error rate - simulation symbol errors can occur with more than one bit error. Therefore we see that this approximation works best at high SNR values. 
\item Finally, it must also be mentioned that the theoretical error rates are calculated using Eb/No rather than the symbol SNR. This conversion is made by dividing the SNR by the number of bits used per symbol. Thus, if the theoretical error rates where plotted with Eb/No values as the x-axis the graphs would shift left.  

\end{itemize}

\appendix
\newpage
%% the \\ insures the section title is centered below the phrase: Appendix B
%\section{Project Assignment}
%\label{app:assign}
%\includepdf[pages={1-5}]{project_overview.pdf}
%\cleardoublepage
%\newpage


\section{Random Bit Sequence Generator}
\label{app:random_bit_generator}
\lstinputlisting{random_bit_generator.m}

\section{Bit to Symbol Mappers}
\label{app:bittosym}
\subsection{BPSK Modulation }
\label{app:bpsk_mod}
% To convert program (e.g. C++ Fortran, Matlab, LaTeX) listings to a
% form easily includable in a LaTeX document
%
% type lgrind -s to see options
% lgrind -llatex -i sample-paper.tex > sampleinputtex
% creates a file sampleinput.tex which can then be included into this
% document simply by uncommenting the next line
%\lgrindfile{testinput.tex}

\lstinputlisting{bpsk_mod.m}

\subsection{QPSK Modulation}
\label{app:qpsk_mod}
\lstinputlisting{qpsk_mod.m}

\subsection{16-QAM Modulation}
\label{app:qam_16_mod}

\lstinputlisting{QAM_16_mod.m}

\subsection{64-QAM Modulation }
\label{app:qam_64_mod}
\lstinputlisting{QAM_64_mod.m}

\newpage
\section{Square Root Raised Cosine Filter}
\label{app:sqrt_raised_cosine}
\lstinputlisting{sqrt_raised_cosine.m}


\section{Up Sampler}
\label{app:impulse_train}
\lstinputlisting{impulse_train.m}

\section{Additive Gaussian White Noise Channel}
\label{app:awgn_channel}
\lstinputlisting{awgn_channel.m}


\section{Additive Gaussian White Noise Channel}
\label{app:awgn_channel}
\lstinputlisting{awgn_channel.m}

\newpage
\section{Sampler}
\label{app:sampler}
\lstinputlisting{sampler.m}


\section{Decision Blocks}
\label{app:dblocks}
\subsection{BPSK Demodulation}
\label{app:bpsk_demod}
\lstinputlisting{bpsk_demod.m}

\newpage
\subsection{QPSK Demodulation}
\label{app:qpsk_demod}
\lstinputlisting{qpsk_demod.m}

\subsection{16-QAM Demodulation}
\label{app:qam_16_demod}
\lstinputlisting{QAM_16_demod.m}

\newpage
\subsection{64-QAM Demodulation}
\label{app:qam_64_demod}
\lstinputlisting{QAM_64_demod.m}

\newpage
\section{Offsets}
\label{app:offsets}
\subsection{Carrier Phase Offset}
\label{app:phase_offset}
\lstinputlisting{phase_offset.m}

\newpage
\subsection{Carrier Frequency Offset}
\label{app:freq_offset}
\lstinputlisting{freq_offset.m}


\end{document}